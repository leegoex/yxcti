<html>
<head>
  <title>编译环境的安装</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="781"/>
<h1>编译环境的安装</h1>

<div>
<span><div>1.CentOS6.7 32位。安装操作系统时，选择Basic Server。</div><div><br/></div><div>3.启用网络。使用桥接方式连接到网络，并且启动后自动连接到网络。因为我们选择的是Basic Server，它没有操作界面。所以我们需要通过修改配置文件来达到自动连接到网络的目的：</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>vi /etc/sysconfig/network-scripts/ifconfig-eth0</div><div>ONBOOT=no</div><div>改为</div><div>ONBOOT=yes</div></div><div><br/></div><div>4.安装git</div><div><br/></div><div>5.生成证书（先略过）</div><div><br/></div><div>6.下载并修改配置文件WebRtC-to-SIP</div><div><a href="编译环境的安装_files/WEBRTC-to-SIP-master.zip"><img src="编译环境的安装_files/5949a61d81589a815e5ffcd0989d50ec.png" alt="WEBRTC-to-SIP-master.zip"></a><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>cd WEBRTC-to-SIP-master</div><div>find . -type f -print0 | xargs -0 sed -i 's/XXXXX-XXXXX/PUT-IP-OF-YOUR-SIPSERVER-HERE/g'</div><div>find . -type f -print0 | xargs -0 sed -i 's/XXXX-XXXX/PUT-DOMAIN-OF-YOURSIP-SERVER-HERE/g'</div><div>find . -type f -print0 | xargs -0 sed -i 's/XXX-XXX/PUT-DOMAIN-OF-YOURTURN-SERVER-HERE/g'</div></div><div><br/></div><div><br/></div><div>7.安装RTPEngine</div><div><a href="编译环境的安装_files/rtpengine-master.zip"><img src="编译环境的安装_files/7c961c9c92fe803b00c12deef9ba6b5b.png" alt="rtpengine-master.zip"></a><br/></div><div>7.1安装依赖</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>yum install pkgconfig glib2 glib2-devel zlib zlib-devel openssl openssl-devel pcre pcre-devel xmlrpc-c xmlrpc-c-devel libpcap libpcap-devel libevent2 libevent2-devel<br/></div></div><div><br/></div><div>7.2源码编译和安装hiredis</div><div>7.2.1 安装编译工具</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">yum groupinstall 'Development Tools'</div><div>7.2.2修改默认的Makefile，将prefix?=/usr/local修改为prefix?=/usr</div><div>7.2.3执行make &amp;&amp; make install</div><div><br/></div><div>7.3源码编译和安装RTPEngine</div><div>7.3.1编译daemon</div><ul><li>修改Makefile文件，将-std=c99修改为-std=gnu99</li><li>拷贝生成的rtpengine到/usr/sbin目录下cp rtpengine /usr/sbin</li></ul><div><br/></div><div>7.3.2编译iptables-extension</div><ul><li>先安装依赖yum install iptables-devel</li><li>拷贝生成的动态库到/lib/xtables目录下 cp libxt_RTPENGINE.so /lib/xtables/</li></ul><div><br/></div><div>7.3.2编译kernel-module</div><ul><li>安装依赖yum install kernel-devel kernel-headers</li><li>创建链接ln -sf /usr/src/kernels/$(uname -r)/ /lib/modules/$(uname -r)/build</li><li>拷贝编译生成的xt_RTPENGINE.ko到制定目录下cp xt_RTPENGINE.ko /lib/modules/$(uname -r)/updates</li><li>执行命令depmod -a</li><li>执行命令modprobe xt_RTPENGINE</li></ul><div><br/></div><div>8.启动RTPEngine</div><div align="left" style="min-height: 12pt;"><ul><li><font color="#010101" face="CourierNewPSMT" size="2"><span style="font-size:10pt">cp etc/default/ngcp-rtpengine-daemon /etc/default/rtpengine</span></font></li><li>启动RTPEngine(--foreground表示在前台运行)</li></ul><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>/usr/sbin/rtpengine --interface 192.168.6.202 --listen-tcp 25060 --listen-udp 12222 --listen-ng 22222 --listen-cli 9900 --timeout 60 --silent-timeout=3600 --pidfile /var/run/rtpengine.pid --foreground --port-min 16384 --port-max 16485 --log-stderr --log-level 7<br/></div></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="color: rgb(1, 1, 1);"><span style="font-family: CourierNewPSMT;">9.安装防火墙规则(先略过)</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">10.安装Kamailio</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">10.1获取源码</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">git clone https://github.com/kamailio/kamailio.git kamailio</span></span></div><div><span style="color: rgb(1, 1, 1);"><span style="font-family: CourierNewPSMT;">cd kamailio</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">git checkout -b 4.4 origin/4.4</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">10.2安装mysql</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">yum install mysql-server mysql-devel libunistring libunistring-devel lksctp-tools lksctp-tools-devel -y</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">10.3编译Kamailio</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">mkdir -p /home/CloudShare</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">make PREFIX=&quot;/home/CloudShare&quot; include_modules=&quot;db_mysql carrierroute websocket sctp tls&quot; cfg</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">make all</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">make install</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">10.4创建MySQL数据库</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">10.5编辑配置文件</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">11.安装Web服务器</span></span></div><div><span style="color: rgb(1, 1, 1);"><span style="font-family: CourierNewPSMT;">Apache</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">12.源码安装turnserver</span></span></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">/usr/bin/turnserver --listening-port 19302 --fingerprint --lt-cred-mech --user websip:websip --realm 192.168.6.202</span></span></span></div></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);">附件：（启动脚本）</span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><a href="编译环境的安装_files/run_webrtc2sipgateway.sh"><img src="编译环境的安装_files/686a950dc2e08eacabc78b4584db35ad.png" alt="run_webrtc2sipgateway.sh"></a><br/></span></span></div><div><span style="font-family: CourierNewPSMT;"><span style="color: rgb(1, 1, 1);"><br/></span></span></div></div></span>
</div></body></html> 